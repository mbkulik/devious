#!/usr/bin/env bash
#
# Michael B. Kulik
# 6/6/2011
#
# deploy script for devious site
#
# use git-diff --name-only to get a list of changed files for pushing to 
# devious

doProduction=0
doTesting=0

while getopts "pt" flag
do
    if [ "$flag" = "p" ]; then
        doProduction=1
    fi

    if [ "$flag" = "t" ]; then
        doTesting=1
    fi
done

if [ $doProduction = 1 ]; then
    topush=`git diff --name-only`
    for file in $topush
    do
        echo "Deploying $file"
        scp -r $file mk@devio.us:/home/mk/public_html/$file
    done
elif [ $doTesting = 1 ]; then
    if [ `uname` = "Darwin" ]; then
        open index.html
    else
        xdg-open index.html
    fi
else
    echo -e "usage: $0 {p|t}\np -> production\nt -> testing"
fi
